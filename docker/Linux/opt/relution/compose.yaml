services:
  database:
    image: postgres:18
    restart: always
    container_name: docker_database
    networks:
      relution-network:
        aliases:
          - database-docker
    environment:
      - TZ=Europe/Berlin
      - POSTGRES_DB=relution
      - POSTGRES_USER=relution
      - POSTGRES_PASSWORD=%POSTGRES_PASSWORD%
    expose:
      - '5432'
    volumes:
      - 'postgresql:/var/lib/postgresql'

  relution:
    image: relution/relution:latest
    restart: always
    container_name: docker_relution
    networks:
      relution-network:
        aliases:
          - relution-docker
    depends_on:
      - mariadb
    links:
      - database
    environment:
      - TZ=Europe/Berlin
    expose:
      - '8080'
      - '8099'
    volumes:
      - './application.yml:/opt/relution/application.yml'

  nginx:
    image: nginx:stable
    restart: always
    container_name: docker_nginx
    networks:
      relution-network:
        aliases:
          - nginx-docker
    depends_on:
      - relution
    links:
      - relution
    environment:
     - TZ=Europe/Berlin
     - NGINX_HOST=%EXT_HOSTNAME%
    ports:
     - "80:80"
     - "443:443"
    volumes:
     - '/opt/relution/relution-nginx.conf:/etc/nginx/conf.d/relution-nginx.conf'
     - '/opt/relution/server.pem:/etc/nginx/server.pem'
     - '/opt/relution/server.key:/etc/nginx/server.key'

volumes:
  postgresql:

networks:
  relution-network:
